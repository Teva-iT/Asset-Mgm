generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model ScanHistory {
  ScanID    String   @id @default(uuid())
  ScannedAt DateTime @default(now())
  Outcome   String // Found, Not Found, Error
  Method    String // Scanner, Manual
  Query     String? // What was actually scanned

  // Relations
  CalculatedStatus String? // Snapshot of status at time of scan
  AssetID          String?
  Asset            Asset?   @relation(fields: [AssetID], references: [AssetID])

  ScannedByUserID String?
  ScannedBy       User?   @relation(fields: [ScannedByUserID], references: [UserID])
}

model Asset {
  AssetID      String   @id @default(uuid())
  AssetType    String?
  OwnershipType String? // Individual, Shared, Stock
  Quantity     Int?     @default(1)
  Location     String?  // For shared assets
  AssetName    String?
  Brand        String?
  Model        String?
  SerialNumber String?
  DeviceTag    String?
  Status       String?   // Available, Assigned, Returned, Lost, Damaged, In Stock
  Condition    String?   // New (Unboxed), Used (Good), Used (Needs Check), Damaged
  OperationalState String? // Not Imaged, Imaged (Ready), In Preparation, Retired
  PurchaseDate DateTime?
  Notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  assignments  Assignment[]
  ScanHistory  ScanHistory[]
  Photos       AssetPhoto[]
}

model AssetPhoto {
  PhotoID     String   @id @default(uuid())
  AssetID     String
  URL         String
  Category    String   @default("General") // General, Barcode, Serial, Location
  UploadedBy  String?  // UserID or Name
  createdAt   DateTime @default(now())

  Asset       Asset    @relation(fields: [AssetID], references: [AssetID])
}

model Employee {
  EmployeeID String   @id @default(uuid())
  FirstName  String
  LastName   String
  Email      String   @unique
  Slug       String?  @unique
  Department String
  StartDate  DateTime
  EndDate    DateTime?
  Status     String   @default("Active") // Active, Leaving, Left
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  assignments Assignment[]
}

model Assignment {
  AssignmentID       String    @id @default(uuid())
  AssetID            String
  EmployeeID         String
  AssignedDate       DateTime  @default(now())
  ExpectedReturnDate DateTime?
  ActualReturnDate   DateTime?
  Status             String    // Active, Returned
  Notes              String?
  AssignedByUserID   String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  Asset    Asset    @relation(fields: [AssetID], references: [AssetID])
  Employee Employee @relation(fields: [EmployeeID], references: [EmployeeID])
  AssignedBy User?  @relation("AssignedBy", fields: [AssignedByUserID], references: [UserID])
}

model User {
  UserID       String         @id @default(uuid())
  Username     String         @unique
  Password     String
  Role         String         @default("VIEWER") // ADMIN, VIEWER
  CreatedAt    DateTime       @default(now())
  UpdatedAt    DateTime       @updatedAt
  AssignedAssets Assignment[] @relation("AssignedBy")
  ScannedHistory ScanHistory[]
}

model AssetType {
  TypeID        String   @id @default(uuid())
  Name          String   @unique
  OwnershipType String   @default("Individual") // Individual, Shared, Stock
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Department {
  DepartmentID String   @id @default(uuid())
  Name         String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model AssetRequest {
  RequestID     String   @id @default(uuid())
  FirstName     String
  LastName      String
  Email         String
  RequestType   String // Return, Delivery, Exchange
  RequestedDate DateTime
  Notes         String?
  Status        String   @default("Pending") // Pending, Approved, Completed
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
